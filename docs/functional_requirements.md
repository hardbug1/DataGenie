# DataGenie 기능 요구사항 명세서

## 📋 문서 정보
- **프로젝트명**: DataGenie (LLM 기반 데이터 질의·분석·시각화 서비스)
- **작성일**: 2024년
- **버전**: 1.0

## 🎯 프로젝트 개요

### 목적
SQL 지식이 없는 비즈니스 담당자들이 자연어 질문을 통해 데이터베이스 조회 및 Excel 파일 분석을 수행하고, 시각화된 결과를 얻을 수 있는 AI 분석 비서 시스템

### 핵심 가치
- **접근성**: SQL 지식 없이도 데이터 분석 가능
- **효율성**: 실시간 질의응답으로 빠른 인사이트 도출
- **직관성**: 자연어 기반 인터페이스로 누구나 쉽게 사용

## 🚀 시스템 플로우

```
사용자 질문 입력
       ↓
질문 유형 분석 (LLM)
       ↓
    ┌─────────┬─────────┐
    ↓         ↓         ↓
 DB 질의   Excel 분석  기타
    ↓         ↓         ↓
SQL 생성   Python 코드  일반 응답
    ↓      생성/실행      ↓
 DB 실행      ↓         ↓
    ↓    결과 처리      ↓
    └─────────┼─────────┘
             ↓
       결과 분석 (LLM)
             ↓
       시각화 생성
             ↓
     Gradio UI 출력
```

## 📚 상세 기능 요구사항

### 1. 자연어 처리 모듈

#### 1.1 질문 분석 및 라우팅
**기능 설명**: 사용자의 자연어 질문을 분석하여 적절한 처리 경로로 라우팅

**입력**: 한국어/영어 자연어 질문
**출력**: 처리 유형 (DB_QUERY, EXCEL_ANALYSIS, GENERAL)

**세부 요구사항**:
- [x] 한국어 자연어 질문 처리 (주력)
- [x] 영어 및 한영 혼재 표현 지원
- [x] 질문 유형 자동 분류
  - 데이터베이스 조회: "매출 현황", "고객 수", "월별 트렌드" 등
  - Excel 분석: "파일 분석", "차트 생성", "통계 요약" 등
  - 일반 질문: 사용법, 도움말 등
- [x] 문맥 이해 (이전 질문과의 연관성)
- [x] 애매한 질문에 대한 명확화 요청

**성능 기준**:
- 질문 분류 정확도: 95% 이상
- 응답 시간: 2초 이내

#### 1.2 질문 이력 관리
**기능 설명**: 사용자의 질문 기록을 관리하고 컨텍스트 유지

**세부 요구사항**:
- [x] 세션 기반 질문 이력 저장 (최대 10개)
- [x] 이전 질문 참조 기능 ("이전 결과에서...")
- [x] 질문 즐겨찾기 (선택사항)
- [x] 브라우저 종료시 자동 삭제

#### 1.3 질문 추천 시스템
**기능 설명**: 데이터 특성에 맞는 예시 질문 제공

**세부 요구사항**:
- [x] 데이터 스키마 기반 질문 템플릿 생성
- [x] 자주 묻는 질문 (FAQ) 제공
- [x] 데이터 유형별 예시 질문
  - 매출 데이터: "월별 매출 추이는?", "최고 매출 제품은?"
  - 고객 데이터: "신규 고객 수는?", "고객 연령대 분포는?"
- [x] 질문 자동완성 (향후 확장)

### 2. 데이터베이스 질의 모듈

#### 2.1 SQL 생성 및 실행
**기능 설명**: 자연어 질문을 SQL 쿼리로 변환하여 실행

**지원 데이터베이스**:
- PostgreSQL (주력)
- MySQL (주력)
- SQLite (개발/테스트)

**세부 요구사항**:
- [x] 자연어 → SQL 변환 (LangChain SQLDatabaseChain 활용)
- [x] 복합 조건 쿼리 지원
- [x] 집계 함수 활용 (SUM, COUNT, AVG, MAX, MIN)
- [x] 시계열 데이터 처리 (날짜 기반 그룹핑)
- [x] JOIN 연산 지원 (기본 수준)
- [x] 안전한 쿼리 실행 (읽기 전용, SQL Injection 방지)

**지원 쿼리 패턴**:
```sql
-- 기본 조회
SELECT * FROM products WHERE category = '전자제품'

-- 집계 분석
SELECT DATE_TRUNC('month', order_date), SUM(amount) 
FROM orders GROUP BY DATE_TRUNC('month', order_date)

-- 순위 분석
SELECT product_name, sales_amount, 
       RANK() OVER (ORDER BY sales_amount DESC)
FROM product_sales
```

**제한사항**:
- [x] 데이터 수정 쿼리 금지 (INSERT, UPDATE, DELETE)
- [x] 복잡한 서브쿼리 제한
- [x] 실행 시간 제한 (30초)
- [x] 결과 행 수 제한 (10,000행)

#### 2.2 데이터베이스 연결 관리
**기능 설명**: 멀티 데이터베이스 연결 및 관리

**세부 요구사항**:
- [x] 환경변수 기반 연결 정보 관리
- [x] Connection Pool 활용
- [x] SSL/TLS 보안 연결
- [x] 연결 상태 모니터링
- [x] 자동 재연결 메커니즘

**연결 정보 예시**:
```python
DATABASE_CONFIGS = {
    "main_db": {
        "type": "postgresql",
        "host": "localhost",
        "port": 5432,
        "database": "company_db",
        "username": "readonly_user",
        "password": "***",
        "ssl_mode": "require"
    }
}
```

#### 2.3 결과 처리 및 후처리
**기능 설명**: 쿼리 결과를 사용자 친화적으로 가공

**세부 요구사항**:
- [x] 대용량 결과 페이지네이션
- [x] 개인정보 자동 마스킹
- [x] 데이터 타입 자동 추론
- [x] NULL 값 처리
- [x] 숫자 포맷팅 (천단위 구분자)
- [x] 날짜 형식 표준화

### 3. Excel 분석 모듈

#### 3.1 파일 업로드 및 처리
**기능 설명**: Excel 파일 업로드 및 데이터 추출

**지원 파일 형식**:
- .xlsx, .xls, .csv, .tsv

**세부 요구사항**:
- [x] 드래그앤드롭 업로드 인터페이스
- [x] 파일 크기 제한 (최대 50MB)
- [x] 행 수 제한 (최대 100만 행)
- [x] 다중 시트 지원
- [x] 자동 인코딩 감지 (UTF-8, EUC-KR)
- [x] 헤더 자동 감지
- [x] 데이터 타입 자동 추론

**처리 플로우**:
```
파일 업로드 → 유효성 검사 → 데이터 추출 → 스키마 분석 → 메모리 로드
```

#### 3.2 데이터 분석 및 코드 생성
**기능 설명**: Pandas 기반 데이터 분석 코드 자동 생성

**지원 분석 유형**:
- 기술통계 (describe, info)
- 집계 분석 (groupby, pivot)
- 필터링 및 정렬
- 상관관계 분석
- 시계열 분석 (기본)

**세부 요구사항**:
- [x] 자연어 → Pandas 코드 변환
- [x] 동적 코드 실행 (안전한 환경)
- [x] 에러 핸들링 및 복구
- [x] 코드 실행 시간 제한 (10초)
- [x] 메모리 사용량 모니터링

**생성 코드 예시**:
```python
# "월별 매출 합계를 구해줘"
monthly_sales = df.groupby(df['date'].dt.to_period('M'))['sales'].sum()
result = monthly_sales.reset_index()
```

#### 3.3 Excel 세션 관리
**기능 설명**: 업로드된 Excel 파일의 세션 기반 관리

**세부 요구사항**:
- [x] 사용자별 임시 파일 저장
- [x] 세션 만료시 자동 삭제 (1시간)
- [x] 동시 파일 처리 제한 (사용자당 1개)
- [x] 메모리 효율적 처리

### 4. 시각화 모듈

#### 4.1 차트 생성
**기능 설명**: 분석 결과를 다양한 차트로 시각화

**지원 차트 유형**:
- 막대그래프 (Bar Chart)
- 선그래프 (Line Chart)  
- 파이차트 (Pie Chart)
- 히스토그램 (Histogram)
- 산점도 (Scatter Plot)
- 박스플롯 (Box Plot)
- 히트맵 (Heatmap) - 향후

**세부 요구사항**:
- [x] Plotly 기반 인터랙티브 차트
- [x] 반응형 디자인 (모바일 대응)
- [x] 차트 유형 자동 추천
- [x] 색상 테마 일관성
- [x] 한글 폰트 지원
- [x] 범례 및 라벨 자동 생성

**차트 선택 로직**:
```python
def recommend_chart_type(data_info):
    if data_info['has_time_series']:
        return 'line'
    elif data_info['categorical_count'] <= 10:
        return 'bar'
    elif data_info['is_numerical_distribution']:
        return 'histogram'
    else:
        return 'table'
```

#### 4.2 테이블 표시
**기능 설명**: 데이터를 정렬 가능한 테이블로 표시

**세부 요구사항**:
- [x] 페이지네이션 (50행 단위)
- [x] 컬럼별 정렬
- [x] 검색 및 필터링
- [x] 셀 내용 복사 기능
- [x] 숫자 포맷팅
- [x] 반응형 테이블 디자인

#### 4.3 결과 내보내기
**기능 설명**: 분석 결과를 다양한 형식으로 내보내기

**지원 형식**:
- 이미지: PNG, SVG
- 데이터: CSV, Excel
- 차트: HTML (인터랙티브)

**세부 요구사항**:
- [x] 고화질 이미지 내보내기
- [x] 원본 데이터 포함 Excel 내보내기
- [x] 차트 설정 포함 내보내기
- [x] 일괄 내보내기 (분석 + 차트)

### 5. 응답 생성 모듈

#### 5.1 자연어 응답 생성
**기능 설명**: 분석 결과를 자연어로 요약 설명

**세부 요구사항**:
- [x] 한국어 자연어 응답 생성
- [x] 핵심 인사이트 추출
- [x] 수치 데이터 해석
- [x] 비교 분석 결과 설명
- [x] 추가 분석 제안

**응답 템플릿 예시**:
```
📊 분석 결과 요약

주요 발견사항:
• 전체 매출은 {total_sales:,}원입니다
• 가장 높은 매출을 기록한 월은 {best_month}({best_amount:,}원)입니다
• 전월 대비 {growth_rate}% 증가했습니다

💡 인사이트:
• {insight_description}

🔍 추가 분석 제안:
• "{suggested_question}"를 물어보시는 것은 어떨까요?
```

#### 5.2 멀티모달 응답
**기능 설명**: 텍스트 + 표 + 차트 통합 응답

**세부 요구사항**:
- [x] 응답 구성 요소 자동 결정
- [x] 적절한 표시 순서 (요약 → 차트 → 상세 데이터)
- [x] 시각적 일관성 유지
- [x] 반응형 레이아웃

### 6. 사용자 인터페이스 (Gradio)

#### 6.1 메인 인터페이스
**기능 설명**: 사용자 질문 입력 및 결과 표시

**구성 요소**:
- 질문 입력 텍스트박스
- 파일 업로드 영역
- 결과 표시 영역
- 질문 이력 사이드바

**세부 요구사항**:
- [x] 직관적인 레이아웃
- [x] 실시간 타이핑 피드백
- [x] 로딩 상태 표시
- [x] 에러 메시지 친화적 표시
- [x] 반응형 디자인

#### 6.2 설정 및 관리
**기능 설명**: 시스템 설정 및 사용자 관리

**세부 요구사항**:
- [x] 데이터베이스 연결 설정
- [x] 사용자 인증 (기본)
- [x] 세션 관리
- [x] 사용 통계 표시 (관리자)

#### 6.3 도움말 및 가이드
**기능 설명**: 사용법 안내 및 예시 제공

**세부 요구사항**:
- [x] 인터랙티브 튜토리얼
- [x] 질문 예시 갤러리
- [x] FAQ 섹션
- [x] 문제 해결 가이드

## 🔧 기능 우선순위

### Phase 1 (MVP - 2개월)
1. **필수 기능**
   - 자연어 질문 분석
   - 기본 SQL 생성 및 실행
   - 간단한 Excel 분석
   - 막대/선/파이 차트
   - 기본 Gradio 인터페이스

2. **데이터베이스 지원**
   - PostgreSQL 또는 MySQL 중 1개
   - 기본 연결 관리

3. **분석 기능**
   - 기술통계
   - 기본 집계 (SUM, COUNT, AVG)
   - 간단한 필터링

### Phase 2 (정식 버전 - 4개월)
1. **확장 기능**
   - 멀티 데이터베이스 지원
   - 고급 시각화 (히스토그램, 산점도)
   - 시계열 분석
   - 상관관계 분석

2. **사용자 경험**
   - 질문 추천 시스템
   - 결과 내보내기
   - 사용자 인증
   - 세션 관리

3. **성능 최적화**
   - 캐싱 시스템
   - 쿼리 최적화
   - 반응형 UI

### Phase 3 (향후 확장)
1. **고급 분석**
   - 예측 모델링
   - 클러스터링
   - 이상치 탐지

2. **엔터프라이즈 기능**
   - 다중 조직 지원
   - 고급 권한 관리
   - API 제공
   - 대시보드 기능

## ✅ 검증 기준

### 기능 검증
- [ ] 질문 분류 정확도 90% 이상
- [ ] SQL 생성 성공률 85% 이상
- [ ] Excel 분석 완료율 95% 이상
- [ ] 시각화 생성 성공률 98% 이상

### 성능 검증
- [ ] 간단한 질의 응답 시간 5초 이내
- [ ] 복잡한 분석 완료 시간 15초 이내
- [ ] 동시 사용자 10명 지원
- [ ] 시스템 가용률 99% 이상

### 사용성 검증
- [ ] 사용자 만족도 4.0/5.0 이상
- [ ] 평균 학습 시간 10분 이내
- [ ] 질문 성공률 80% 이상
- [ ] 에러 발생시 복구 가능

---

**문서 승인**: ✅ 요구사항 정의 완료  
**다음 단계**: 시스템 아키텍처 설계서 작성
